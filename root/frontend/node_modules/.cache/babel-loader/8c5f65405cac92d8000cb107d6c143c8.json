{"ast":null,"code":"var _s = $RefreshSig$();\n\n/* eslint-disable @typescript-eslint/no-unused-vars */\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport { useEffect, useState, useRef } from \"react\";\nimport useGameLogic from \"./useGameLogic\";\nexport default function useGame(render) {\n  _s();\n\n  const requestID = useRef(null);\n  const previousTime = useRef(null);\n  const gameLogic = useGameLogic();\n  const [gameData, setGameData] = useState(gameLogic.gameDataRef.current);\n  const speed = gameData.speed;\n  const oldSnakePosition = gameData.snakePosition;\n  let currentlyDrawnSnakePosition;\n  const newUpdateFrameRef = useRef(-1);\n  const newRenderFrameRef = useRef(-1);\n\n  function loop(time) {\n    if (time > newUpdateFrameRef.current) {\n      newUpdateFrameRef.current = time + speed;\n      currentlyDrawnSnakePosition = oldSnakePosition;\n      gameLogic.update();\n    } else if (time > speed / 64) {\n      newUpdateFrameRef.current = time + speed / 64;\n      console.log(\"gowno\");\n    }\n\n    setGameData({ ...gameLogic.gameDataRef.current\n    });\n    previousTime.current = time;\n    requestID.current = requestAnimationFrame(loop);\n  }\n\n  useEffect(() => {\n    render(oldSnakePosition, currentlyDrawnSnakePosition, gameData.snakePosition);\n  }, [gameData]);\n  useEffect(() => {\n    requestID.current = requestAnimationFrame(loop);\n    return () => cancelAnimationFrame(requestID.current);\n  }, []);\n  return { ...gameLogic,\n    gameData\n  };\n}\n\n_s(useGame, \"VOCBZzHmgMFFxTgiVtVc0ca9Ef8=\", false, function () {\n  return [useGameLogic];\n});","map":{"version":3,"names":["useEffect","useState","useRef","useGameLogic","useGame","render","requestID","previousTime","gameLogic","gameData","setGameData","gameDataRef","current","speed","oldSnakePosition","snakePosition","currentlyDrawnSnakePosition","newUpdateFrameRef","newRenderFrameRef","loop","time","update","console","log","requestAnimationFrame","cancelAnimationFrame"],"sources":["C:/Users/rydwan/Documents/GitHub/snake/src/components/GameSite/useGame.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\n/* eslint-disable react-hooks/exhaustive-deps */\r\nimport React, { useEffect, useState, useRef } from \"react\";\r\nimport useGameLogic from \"./useGameLogic\";\r\n\r\nexport default function useGame(\r\n  render: (\r\n    oldSnakePosition: number[][],\r\n    currentlyDrawnSnakePosition: number[][],\r\n    newSnakePosition: number[][]\r\n  ) => void\r\n) {\r\n  const requestID = useRef<number | null>(null);\r\n  const previousTime = useRef<number | null>(null);\r\n\r\n  const gameLogic = useGameLogic();\r\n\r\n  const [gameData, setGameData] = useState(gameLogic.gameDataRef.current);\r\n  const speed = gameData.speed;\r\n\r\n  const oldSnakePosition = gameData.snakePosition;\r\n  let currentlyDrawnSnakePosition: number[][];\r\n\r\n  const newUpdateFrameRef = useRef(-1);\r\n  const newRenderFrameRef = useRef(-1);\r\n\r\n  function loop(time: number) {\r\n    if (time > newUpdateFrameRef.current) {\r\n      newUpdateFrameRef.current = time + speed;\r\n\r\n      currentlyDrawnSnakePosition = oldSnakePosition;\r\n\r\n      gameLogic.update();\r\n    } else if (time > speed / 64) {\r\n      newUpdateFrameRef.current = time + speed / 64;\r\n      console.log(\"gowno\");\r\n    }\r\n    setGameData({ ...gameLogic.gameDataRef.current });\r\n    previousTime.current = time;\r\n\r\n    requestID.current! = requestAnimationFrame(loop);\r\n  }\r\n\r\n  useEffect(() => {\r\n    render(\r\n      oldSnakePosition,\r\n      currentlyDrawnSnakePosition,\r\n      gameData.snakePosition\r\n    );\r\n  }, [gameData]);\r\n\r\n  useEffect(() => {\r\n    requestID.current = requestAnimationFrame(loop);\r\n\r\n    return () => cancelAnimationFrame(requestID.current!);\r\n  }, []);\r\n  return { ...gameLogic, gameData };\r\n}\r\n"],"mappings":";;AAAA;;AACA;AACA,SAAgBA,SAAhB,EAA2BC,QAA3B,EAAqCC,MAArC,QAAmD,OAAnD;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AAEA,eAAe,SAASC,OAAT,CACbC,MADa,EAMb;EAAA;;EACA,MAAMC,SAAS,GAAGJ,MAAM,CAAgB,IAAhB,CAAxB;EACA,MAAMK,YAAY,GAAGL,MAAM,CAAgB,IAAhB,CAA3B;EAEA,MAAMM,SAAS,GAAGL,YAAY,EAA9B;EAEA,MAAM,CAACM,QAAD,EAAWC,WAAX,IAA0BT,QAAQ,CAACO,SAAS,CAACG,WAAV,CAAsBC,OAAvB,CAAxC;EACA,MAAMC,KAAK,GAAGJ,QAAQ,CAACI,KAAvB;EAEA,MAAMC,gBAAgB,GAAGL,QAAQ,CAACM,aAAlC;EACA,IAAIC,2BAAJ;EAEA,MAAMC,iBAAiB,GAAGf,MAAM,CAAC,CAAC,CAAF,CAAhC;EACA,MAAMgB,iBAAiB,GAAGhB,MAAM,CAAC,CAAC,CAAF,CAAhC;;EAEA,SAASiB,IAAT,CAAcC,IAAd,EAA4B;IAC1B,IAAIA,IAAI,GAAGH,iBAAiB,CAACL,OAA7B,EAAsC;MACpCK,iBAAiB,CAACL,OAAlB,GAA4BQ,IAAI,GAAGP,KAAnC;MAEAG,2BAA2B,GAAGF,gBAA9B;MAEAN,SAAS,CAACa,MAAV;IACD,CAND,MAMO,IAAID,IAAI,GAAGP,KAAK,GAAG,EAAnB,EAAuB;MAC5BI,iBAAiB,CAACL,OAAlB,GAA4BQ,IAAI,GAAGP,KAAK,GAAG,EAA3C;MACAS,OAAO,CAACC,GAAR,CAAY,OAAZ;IACD;;IACDb,WAAW,CAAC,EAAE,GAAGF,SAAS,CAACG,WAAV,CAAsBC;IAA3B,CAAD,CAAX;IACAL,YAAY,CAACK,OAAb,GAAuBQ,IAAvB;IAEAd,SAAS,CAACM,OAAV,GAAqBY,qBAAqB,CAACL,IAAD,CAA1C;EACD;;EAEDnB,SAAS,CAAC,MAAM;IACdK,MAAM,CACJS,gBADI,EAEJE,2BAFI,EAGJP,QAAQ,CAACM,aAHL,CAAN;EAKD,CANQ,EAMN,CAACN,QAAD,CANM,CAAT;EAQAT,SAAS,CAAC,MAAM;IACdM,SAAS,CAACM,OAAV,GAAoBY,qBAAqB,CAACL,IAAD,CAAzC;IAEA,OAAO,MAAMM,oBAAoB,CAACnB,SAAS,CAACM,OAAX,CAAjC;EACD,CAJQ,EAIN,EAJM,CAAT;EAKA,OAAO,EAAE,GAAGJ,SAAL;IAAgBC;EAAhB,CAAP;AACD;;GApDuBL,O;UAUJD,Y"},"metadata":{},"sourceType":"module"}